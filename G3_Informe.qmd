---
title: "G3_Informe"
author:
  - Abanto Romero, Jesus Alejandro
  - Cachique Moncada, Renato
  - Flores Guevara, Tamy Kristel
  - Llerena Silva, Nicolás Alejandro 
  - Sobenes Obregon, Carlos Sebastian 
editor: visual
date: "`r format(Sys.time(), '%d %B %Y')`"
lang: es
format: 
  html:
    toc: true
    toc-depth: 3
    number-sections: true
    theme: cosmo
    embed-resources: true
    code-fold: true
    code-summary: "Mostrar / ocultar código"
execute:
  echo: true
  warning: false
  message: false
---

# Introducción

## Relevancia

La pandemia por COVID-19 ha tenido un impacto significativo en la salud pública a nivel mundial. El análisis de datos epidemiológicos permite comprender mejor las características de los casos y los factores asociados a la gravedad de la enfermedad.

Este informe presenta un análisis descriptivo de los **casos sospechosos y confirmados de COVID-19 en México durante el año 2021**, utilizando una muestra de datos oficiales del sistema de vigilancia epidemiológica. Entender estos patrones es crucial para mejorar la respuesta ante futuras emergencias sanitarias.

## Planificación

A continuación se presenta el cronograma de actividades realizado para este proyecto:

```{mermaid}
gantt
    title Planificación del Proyecto
    dateFormat YYYY-MM-DD
    axisFormat %d/%m
    todayMarker off
    
    section Investigación y Diseño
    Definición del tema de investigación        :a1, 2026-01-05, 7d
    Definición de variables relevantes          :a2, 2026-01-12, 10d
    Creación de la herramienta de recolección   :a3, 2026-01-22, 10d
    
    section Análisis de Datos
    Análisis descriptivo de los datos           :b1, 2026-02-01, 9d
    Análisis de interacción                     :b2, 2026-02-10, 11d
    
    section Redacción
    Redacción de resultados e informe final     :d1, 2026-02-21, 9d
```

## Objetivos

### Objetivo General

Analizar los casos sospechosos y confirmados de COVID-19 en México durante el año 2021, describiendo sus principales características demográficas y clínicas.

### Objetivos Específicos

1.  Describir la distribución del score de riesgo COVID y del índice de gravedad en los casos sospechosos y confirmados de COVID-19 en México durante el año 2021.

2.  Evaluar si el Nivel de Riesgo Clínico predice correctamente el Índice de Gravedad del desenlace.

3.  Comparar la distribución de los casos según sexo y clasificación final en los casos sospechosos y confirmados.

# Datos

## Población objetivo

La población está conformada por todos los registros acumulados en el Sistema de Vigilancia Epidemiológica de Enfermedades Respiratorias Viral correspondientes a casos sospechosos y confirmados de COVID-19 en México durante el año 2021. La unidad muestral es el **individuo (paciente)**.

## Tipo de muestreo

Se empleó un muestreo no probabilístico por conveniencia. Al tratarse de un análisis de datos secundarios, se trabajó con la totalidad de observaciones accesibles y validadas en el archivo fuente proporcionado.

## Recolección de datos

La recolección se basó en la descarga y procesamiento de la base de datos abierta del gobierno de México. No se utilizaron instrumentos de recolección primaria (encuestas), sino que se procesó el archivo `muestra_covid_500M_NA.csv`.

## Variables

A continuación se definen las variables seleccionadas y su clasificación:

| \# | Variable | Tipo Estadístico | Origen / Descripción |
|:-----------------|:-----------------|:-----------------|:-----------------|
| 1 | `SCORE_RIESGO_COVID` | Cuantitativa continua | **Derivada:** Índice continuo basado en la carga de comorbilidades y la certeza diagnóstica (Rango 0-3). Resume el nivel relativo de riesgo del paciente. |
| 2 | `INDICE_GRAVEDAD` | Cuantitativa continua | **Derivada:** Índice ponderado de complicaciones (neumonía, UCI, intubación) y defunción. Mide la severidad clínica del caso (Rango 0-1). |
| 3 | `N_COMORBILIDADES` | Cuantitativa discreta | **Derivada:** Suma simple de 10 comorbilidades crónicas (Diabetes, EPOC, Asma, etc.). Valor entero de 0 a 10. |
| 4 | `N_COMPLICACIONES_GRAVES` | Cuantitativa discreta | **Derivada:** Suma de eventos graves: NEUMONIA + INTUBADO + UCI. Indica severidad aguda (0 a 3). |
| 5 | `EDAD` | Cuantitativa discreta | **Original:** Edad del paciente en años completos. |
| 6 | `DIAS_RETRASO` | Cuantitativa discreta | **Derivada:** Diferencia en días entre `FECHA_INGRESO` y `FECHA_SINTOMAS`. Indica la demora en buscar atención médica. |
| 7 | `SEXO` | Cualitativa nominal | **Original:** Sexo del paciente (1: Mujer / 2: Hombre). |
| 8 | `ENTIDAD_RES` | Cualitativa nominal | **Original:** Entidad federativa de residencia (Códigos 1-32). |
| 9 | `ESTADO` | Cualitativa nominal | **Derivada:** Clasificación del desenlace final basada en si existe fecha de defunción (Vivo / Muerto). |
| 10 | `RIESGO_CLINICO` | Cualitativa ordinal | **Derivada:** Categorización del nº de comorbilidades en niveles jerárquicos: Muy bajo (0), Bajo (1-2), Moderado (3-4), Alto (5-6), Muy alto (7-8), Crítico (9-10). |
| 11 | `CLASIFICACION_FINAL` | Cualitativa ordinal | **Original:** Nivel de confirmación del caso (1-7), donde los valores más bajos indican mayor certeza diagnóstica (confirmado por lab, asociación, etc.). |

## Limpieza

En esta sección se detalla la política de manejo de datos faltantes y la creación de variables derivadas.

### Carga y Preprocesamiento

```{r}
if (!require("pacman")) install.packages("pacman")
pacman::p_load(dplyr, ggplot2, lubridate, knitr, tidyr, scales, e1071, kableExtra)
```

```{r}
# Carga de datos
DATOS_INICIALES <- read.csv("muestra_covid_500M_NA.csv")

# Transformación y Creación de Variables
DATOS_TRANSFORMADOS <- DATOS_INICIALES |>
  # Variable ESTADO
  mutate(ESTADO = if_else(is.na(FECHA_DEF), "Vivo", "Muerto")) |>
  # Limpieza EDAD
  mutate(EDAD = ifelse(EDAD == 0 | EDAD > 100, NA, EDAD)) |>
  # DIAS_RETRASO
  mutate(
    FECHA_INGRESO = as.Date(FECHA_INGRESO, format = "%Y-%m-%d"),
    FECHA_SINTOMAS = as.Date(FECHA_SINTOMAS, format = "%Y-%m-%d"),
    DIAS_RETRASO = as.numeric(FECHA_INGRESO - FECHA_SINTOMAS),
    DIAS_RETRASO = if_else(DIAS_RETRASO < 0, NA_real_, DIAS_RETRASO)
  ) |>
  # N_COMORBILIDADES
  mutate(
    N_COMORBILIDADES = rowSums(across(c(DIABETES, EPOC, ASMA, INMUSUPR, 
                                        HIPERTENSION, CARDIOVASCULAR, OBESIDAD, 
                                        RENAL_CRONICA, TABAQUISMO, OTRA_COM), 
                                      ~ ifelse(.x == 1, 1, 0)), na.rm = TRUE)
  ) |>
  # SCORE_RIESGO_COVID
  mutate(
    CARGA_ENFERMEDAD = N_COMORBILIDADES / 10,
    FACTOR_CERTEZA = case_when(
        RESULTADO_LAB == 1 | RESULTADO_ANTIGENO == 1 ~ 3,  
        RESULTADO_LAB == 2 | RESULTADO_ANTIGENO == 2 ~ 1,  
        TRUE ~ 2 
      ),
    SCORE_RIESGO_COVID = CARGA_ENFERMEDAD * FACTOR_CERTEZA,
    SCORE_RIESGO_COVID = ifelse(SCORE_RIESGO_COVID < 0 | SCORE_RIESGO_COVID > 3, NA, SCORE_RIESGO_COVID)
  ) |>
  # INDICE_GRAVEDAD
  mutate(
    NEUMONIA01 = case_when(NEUMONIA == 1 ~ 1, NEUMONIA == 2 ~ 0, TRUE ~ NA_real_),
    UCI01 = case_when(UCI == 1 ~ 1, UCI == 2 ~ 0, TRUE ~ NA_real_),
    INTUBADO01 = case_when(INTUBADO == 1 ~ 1, INTUBADO == 2 ~ 0, TRUE ~ NA_real_),
    DEFUNCION01 = case_when(ESTADO == "Muerto" ~ 1, ESTADO == "Vivo" ~ 0, TRUE ~ NA_real_),
    INDICE_GRAVEDAD = (1*NEUMONIA01 + 2*UCI01 + 3*INTUBADO01 + 4*DEFUNCION01) / 10,
    INDICE_GRAVEDAD = ifelse(INDICE_GRAVEDAD < 0 | INDICE_GRAVEDAD > 1, NA, INDICE_GRAVEDAD)
  ) |>
  # Limpieza ENTIDAD_RES y N_COMPLICACIONES
  mutate(
    ENTIDAD_RES = suppressWarnings(as.integer(ENTIDAD_RES)),
    ENTIDAD_RES = ifelse(ENTIDAD_RES %in% 1:32, ENTIDAD_RES, NA_integer_),
    N_COMPLICACIONES_GRAVES = (NEUMONIA == 1) + (INTUBADO == 1) + (UCI == 1),
    N_COMPLICACIONES_GRAVES = ifelse(N_COMPLICACIONES_GRAVES %in% 0:3, N_COMPLICACIONES_GRAVES, NA)
  ) |>
  # RIESGO_CLINICO
  mutate(
    RIESGO_CLINICO = case_when(
      N_COMORBILIDADES == 0 ~ "Muy bajo (0)",
      between(N_COMORBILIDADES, 1, 2) ~ "Bajo (1-2)",
      between(N_COMORBILIDADES, 3, 4) ~ "Moderado (3-4)",
      between(N_COMORBILIDADES, 5, 6) ~ "Alto (5-6)",
      between(N_COMORBILIDADES, 7, 8) ~ "Muy alto (7-8)",
      between(N_COMORBILIDADES, 9, 10) ~ "Crítico (9-10)",
      TRUE ~ NA_character_
    ),
    RIESGO_CLINICO = factor(RIESGO_CLINICO, levels = c("Muy bajo (0)", "Bajo (1-2)", "Moderado (3-4)", "Alto (5-6)", "Muy alto (7-8)", "Crítico (9-10)"), ordered = TRUE)
  ) |>
  # Limpieza CLASIFICACION_FINAL
  mutate(CLASIFICACION_FINAL = ifelse(CLASIFICACION_FINAL == 7, NA, CLASIFICACION_FINAL))
```

### Manejo de Datos Faltantes (NAs)

A continuación, se cuantifican los valores perdidos y se aplica el filtro para obtener la muestra final ("DATOS_FINALES"), asegurando la calidad de la información analizada.

```{r}
# 1. Selección de columnas de interés
cols_analisis <- c("EDAD", "SEXO", "DIAS_RETRASO", "ENTIDAD_RES", 
                   "N_COMORBILIDADES", "SCORE_RIESGO_COVID", "INDICE_GRAVEDAD", 
                   "N_COMPLICACIONES_GRAVES", "RIESGO_CLINICO", "CLASIFICACION_FINAL")

# 2. Diagnóstico previo (Conteo de NAs)
nas_por_columna <- colSums(is.na(DATOS_TRANSFORMADOS[cols_analisis]))
pct_nas <- round((nas_por_columna / nrow(DATOS_TRANSFORMADOS)) * 100, 2)

# Tabla de diagnóstico
data.frame(
  Variable = names(nas_por_columna),
  NAs_Cantidad = nas_por_columna,
  NAs_Porcentaje = paste0(pct_nas, "%")
) |>
  kbl(caption = "Conteo de valores perdidos por variable antes del filtrado") |>
  kable_styling(bootstrap_options = "striped", full_width = F)

# 3. Ejecución del Filtrado
n_antes <- nrow(DATOS_TRANSFORMADOS)
DATOS_FINALES <- DATOS_TRANSFORMADOS |>
  filter(complete.cases(across(all_of(cols_analisis))))
n_despues <- nrow(DATOS_FINALES)

# 4. Tabla de Balance de Limpieza
data.frame(
  Fase = c("Total Registros Iniciales", "Registros Eliminados (Incompletos)", "Muestra Final Analizable"),
  Cantidad = c(format(n_antes, big.mark=","), format(n_antes - n_despues, big.mark=","), format(n_despues, big.mark=",")),
  Porcentaje = c("100%", paste0(round((n_antes - n_despues)/n_antes*100, 2), "%"), paste0(round(n_despues/n_antes*100, 2), "%"))
) |>
  kbl(caption = "Resumen del impacto de la limpieza de datos") |>
  kable_styling(bootstrap_options = "hover", full_width = F)
```

# Análisis Descriptivo

En esta sección se describen las variables principales del estudio mediante estadísticos de posición (media, mediana), dispersión (desviación estándar) y gráficos exploratorios.

## Análisis Univariado

### Variable Cuantitativa: Score de Riesgo COVID

Analizamos la distribución del riesgo acumulado en la población.

```{r}
# Estadísticos descriptivos
desc_score <- DATOS_FINALES |>
  summarise(
    Media = mean(SCORE_RIESGO_COVID),
    Mediana = median(SCORE_RIESGO_COVID),
    Desv.Std = sd(SCORE_RIESGO_COVID),
    Min = min(SCORE_RIESGO_COVID),
    Max = max(SCORE_RIESGO_COVID)
  )

kbl(desc_score, caption = "Estadísticos descriptivos: Score de Riesgo COVID", digits = 2) |>
  kable_styling(full_width = F)

# Histograma
ggplot(DATOS_FINALES, aes(x = SCORE_RIESGO_COVID)) +
  geom_histogram(bins = 30, fill = "#2C3E50", color = "white", alpha = 0.8) +
  geom_vline(aes(xintercept = mean(SCORE_RIESGO_COVID)), color = "red", linetype = "dashed", size = 1) +
  labs(
    title = "Distribución del Score de Riesgo COVID",
    subtitle = "La línea roja indica el promedio",
    x = "Score de Riesgo (0-3)",
    y = "Frecuencia"
  ) +
  theme_minimal()
```

> **Interpretación:** La mayoría de los casos presentan un score de riesgo bajo a moderado (concentración a la izquierda). La asimetría positiva sugiere que los pacientes con múltiples factores de riesgo y certeza diagnóstica alta son menos frecuentes pero representan el grupo crítico.

### Variable Cuantitativa: Índice de Gravedad

Evaluamos la severidad clínica de los casos.

```{r}
# Boxplot para visualizar outliers y distribución
ggplot(DATOS_FINALES, aes(y = INDICE_GRAVEDAD)) +
  geom_boxplot(fill = "#E74C3C", alpha = 0.7) +
  labs(
    title = "Distribución del Índice de Gravedad",
    y = "Índice (0-1)"
  ) +
  theme_minimal() +
  theme(axis.text.x = element_blank())
```

> **Interpretación:** El diagrama de caja muestra que la mediana del índice de gravedad es muy baja (cercana a 0), lo que indica que una gran proporción de la muestra no desarrolló complicaciones graves (UCI, intubación). Los valores atípicos (puntos superiores) corresponden a los casos severos y defunciones.

### Variable Cualitativa: Sexo

Distribución de la muestra según género.

```{r}
# Tabla de frecuencias
tabla_sexo <- DATOS_FINALES |>
  group_by(SEXO) |>
  summarise(
    Frecuencia = n(),
    Porcentaje = n() / nrow(DATOS_FINALES) * 100
  ) |>
  mutate(Etiqueta = ifelse(SEXO == 1, "Mujer", "Hombre"))

kbl(tabla_sexo, caption = "Distribución de casos por Sexo", digits = 1) |>
  kable_styling(full_width = F)

# Gráfico de barras
ggplot(tabla_sexo, aes(x = Etiqueta, y = Frecuencia, fill = Etiqueta)) +
  geom_col(show.legend = FALSE) +
  geom_text(aes(label = paste0(round(Porcentaje, 1), "%")), vjust = -0.5) +
  scale_fill_manual(values = c("steelblue", "lightpink")) +
  labs(
    title = "Proporción de Casos por Sexo",
    x = "", y = "Cantidad de Casos"
  ) +
  theme_classic()
```

> **Interpretación:** Se observa una distribución equilibrada entre hombres y mujeres en la muestra analizada.

## Análisis Bivariado

Relación entre dos variables (Scatterplots, Boxplots por categoría, Correlaciones).

```{r}
# Ejemplo: Scatterplot
# ggplot(df_clean, aes(x = Var1, y = Var2)) +
#   geom_point(alpha = 0.6) +
#   geom_smooth(method = "lm", se = FALSE, color = "red") +
#   theme_minimal()
```

# Discusión de Resultados

Interpretación de los hallazgos encontrados en los gráficos y tablas anteriores. ¿Qué nos dicen los datos sobre el problema planteado?

# Conclusiones

Resumen de los puntos clave y respuesta a los objetivos planteados al inicio.

1.  Conclusión 1...

2.  Conclusión 2...

# Bibliografía

-   Autor, A. (Año). Título del artículo/libro.
