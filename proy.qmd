---
title: "Proyecto"
format:
  html:
    toc: true
    toc-depth: 3
    theme: cosmo
    code-fold: true
    code-summary: "Mostrar / ocultar código"
execute:
  echo: true
  warning: false
  message: false
---

# Introducción

La pandemia por COVID-19 ha tenido un impacto significativo en la salud pública a nivel mundial.\
El análisis de datos epidemiológicos permite comprender mejor las características de los casos y los factores asociados a la gravedad de la enfermedad.

Este informe presenta un análisis descriptivo de los **casos sospechosos y confirmados de COVID-19 en México durante el año 2021**, utilizando una muestra de datos oficiales del sistema de vigilancia epidemiológica.

# Objetivo general

Analizar los casos sospechosos y confirmados de COVID-19 en México durante el año 2021, describiendo sus principales características demográficas y clínicas.

### Objetivos específicos

1.  *Describir la distribución del score de riesgo COVID y del índice de gravedad en los casos sospechosos y confirmados de COVID-19 en México durante el año 2021.*\
    Variables principales: score_riesgo_covid, indice_gravedad\

2.  *Analizar la relación entre el número de comorbilidades y el tipo de atención recibida por los pacientes en los casos sospechosos y confirmados de COVID-19 en México durante el año 2021.*\
    Variables principales: n_comorbilidades, TIPO_PACIENTE\

3.  *Comparar la distribución de los casos según sexo y clasificación final en los casos sospechosos y confirmados de COVID-19 en México durante el año 2021.*\
    Variables principales: SEXO, CLASIFICACION_FINAL\

# Metodología

### Población de estudio

La población está conformada por los registros acumulados en el **Sistema de Vigilancia Epidemiológica de Enfermedades Respiratorias Viral (SISVER)** correspondientes al año 2021.

### Tipo de muestreo

Se utilizó un **muestreo aleatorio simple**, garantizando que cada individuo tuviera la misma probabilidad de ser seleccionado.

### Unidad muestral

La unidad muestral es el **individuo (paciente)**.\
Cada fila del conjunto de datos representa a una persona registrada en una unidad de salud.


```{mermaid}
gantt
    title Planificación del Proyecto
    dateFormat YYYY-MM-DD
    axisFormat %d/%m
    todayMarker off
    section Investigación y Diseño
    Definición del tema de investigación        :a1, 2026-01-05, 7d
    Definición de variables relevantes          :a2, 2026-01-12, 10d
    Creación de la herramienta de recolección   :a3, 2026-01-22, 10d
    section Análisis de Datos
    Análisis descriptivo de los datos           :b1, 2026-02-01, 9d
    Análisis de interacción                     :b2, 2026-02-10, 11d
    section Redacción y Preparación
    Redacción de resultados e informe final     :d1, 2026-02-21, 9d
```


## Variables seleccionadas para el análisis

+----------+-------------------------+-----------------------+--------------------------------------------------------------------------+----------------------------------------------------------------------------------+
| \#       | Variable                | Tipo estadístico      | Origen / Cómo se obtiene                                                 | Justificación breve                                                              |
+==========+=========================+=======================+==========================================================================+==================================================================================+
| 1        | SCORE_RIESGO_COVID      | Cuantitativa continua | Derivada: índice continuo basado en comorbilidades y certeza diagnóstica | Resume el nivel relativo de riesgo del paciente                                  |
+----------+-------------------------+-----------------------+--------------------------------------------------------------------------+----------------------------------------------------------------------------------+
| 2        | INDICE_GRAVEDAD         | Cuantitativa continua | Derivada: índice ponderado de complicaciones y defunción                 | Mide la severidad clínica del caso                                               |
+----------+-------------------------+-----------------------+--------------------------------------------------------------------------+----------------------------------------------------------------------------------+
| 3        | N_COMORBILIDADES        | Cuantitativa discreta | Derivada: suma de 10 comorbilidades (solo 1=Sí)                          | Conteo entero (0 a 10), discreta por naturaleza                                  |
+----------+-------------------------+-----------------------+--------------------------------------------------------------------------+----------------------------------------------------------------------------------+
| 4        | N_COMPLICACIONES_GRAVES | Cuantitativa discreta | Derivada: suma de NEUMONIA + INTUBADO + UCI (solo 1=Sí)                  | Conteo entero (0 a 3), discreta, indica severidad                                |
+----------+-------------------------+-----------------------+--------------------------------------------------------------------------+----------------------------------------------------------------------------------+
| 5        | EDAD                    | Cuantitativa discreta | Columna original                                                         | Edad en años completos, permite media, desviación estándar, correlaciones, etc.  |
+----------+-------------------------+-----------------------+--------------------------------------------------------------------------+----------------------------------------------------------------------------------+
| 6        | DIAS_RETRASO            | Cuantitativa discreta | Derivada: FECHA_INGRESO - FECHA_SINTOMAS                                 | Tiempo en días (puede tener decimales si usas unidades="days"), continua clásica |
+----------+-------------------------+-----------------------+--------------------------------------------------------------------------+----------------------------------------------------------------------------------+
| 7        | SEXO                    | Cualitativa nominal   | Columna original                                                         | Categorías sin orden: Mujer / Hombre / No especificado                           |
+----------+-------------------------+-----------------------+--------------------------------------------------------------------------+----------------------------------------------------------------------------------+
| 8        | ENTIDAD_RES             | Cualitativa nominal   | Columna original                                                         | 32 entidades federativas + posible 99, sin orden jerárquico                      |
+----------+-------------------------+-----------------------+--------------------------------------------------------------------------+----------------------------------------------------------------------------------+
| 9        | ESTADO                  | Cualitativa nominal   | Derivada de FECHA_DEF                                                    | Si tiene fecha de defunción = Muerto                                             |
|          |                         |                       |                                                                          |                                                                                  |
|          |                         |                       |                                                                          | Caso contrario = Vivo                                                            |
+----------+-------------------------+-----------------------+--------------------------------------------------------------------------+----------------------------------------------------------------------------------+
| 10       | TIPO_PACIENTE           | Cualitativa ordinal   | Columna original                                                         | 1 = Ambulatorio \< 2 = Hospitalizado (orden lógico de gravedad)                  |
+----------+-------------------------+-----------------------+--------------------------------------------------------------------------+----------------------------------------------------------------------------------+
| 11       | CLASIFICACION_FINAL     | Cualitativa ordinal   | Columna original                                                         | Niveles con jerarquía de certeza/severidad (Confirmado \> Sospechoso \> otros)   |
+----------+-------------------------+-----------------------+--------------------------------------------------------------------------+----------------------------------------------------------------------------------+

## Preparación del entorno

```{r}
#| label: setup
#| include: false

library(dplyr)
library(ggplot2)
library(lubridate)
library(knitr)
```

### Carga de datos

```{r}
DATOS_INICIALES <- read.csv("muestra_covid_500M_NA.csv")
```

# DATOS INICIALES

```{r}
str(DATOS_INICIALES)
```

# LIMPIANDO VARIABLES

## ESTADO

```{r}
DATOS_INICIALES <- DATOS_INICIALES |> 
  mutate(ESTADO = if_else(is.na(FECHA_DEF), "Vivo", "Muerto")) |> 
  select(-FECHA_DEF)
```

## SEXO

```{r}
table(DATOS_INICIALES$SEXO, useNA = "always")
```

```{r}
DATOS_INICIALES <- DATOS_INICIALES |> 
  filter(!is.na(SEXO))
```

```{r}
table(DATOS_INICIALES$SEXO, useNA = "always")
```

## EDAD

```{r}
summary(DATOS_INICIALES$EDAD)
```

```{r}
DATOS_INICIALES <- DATOS_INICIALES |> 
  mutate(EDAD = ifelse(EDAD == 0 | EDAD > 100, NA, EDAD))
```

```{r}
summary(DATOS_INICIALES$EDAD)
```

```{r}
DATOS_INICIALES <- DATOS_INICIALES |> 
  filter(!is.na(EDAD))
```

```{r}
summary(DATOS_INICIALES$EDAD)
```

## DIAS_RETRASO

```{r}
library(lubridate)
DATOS_INICIALES <- DATOS_INICIALES |> 
  mutate(
    FECHA_INGRESO = as.Date(FECHA_INGRESO, format = "%Y-%m-%d"),
    FECHA_SINTOMAS = as.Date(FECHA_SINTOMAS, format = "%Y-%m-%d"),
    DIAS_RETRASO = as.numeric(FECHA_INGRESO - FECHA_SINTOMAS),
    DIAS_RETRASO = if_else(DIAS_RETRASO < 0, NA_real_, DIAS_RETRASO)
  )
  
```

```{r}
summary(DATOS_INICIALES$DIAS_RETRASO)
```

```{r}
DATOS_INICIALES <- DATOS_INICIALES |> 
  filter(!is.na(DIAS_RETRASO))
```

```{r}
summary(DATOS_INICIALES$DIAS_RETRASO)
```

## N_COMORBILIDADES

```{r}
DATOS_INICIALES <- DATOS_INICIALES |>
  mutate(
    N_COMORBILIDADES = rowSums(
      across(
        c(
          DIABETES,
          EPOC,
          ASMA,
          INMUSUPR,
          HIPERTENSION,
          CARDIOVASCULAR,
          OBESIDAD,
          RENAL_CRONICA,
          TABAQUISMO,
          OTRA_COM
        ),
        ~ ifelse(.x == 1, 1, 0)
      ),
      na.rm = TRUE
    )
  )

```

```{r}
summary(DATOS_INICIALES$N_COMORBILIDADES)
```

## SORE_RIESGO_COVID

```{r}
table(DATOS_INICIALES$RESULTADO_LAB, useNA = "always")
table(DATOS_INICIALES$RESULTADO_ANTIGENO, useNA = "always")
```

```{r}
DATOS_INICIALES <- DATOS_INICIALES |>
  mutate(
    CARGA_ENFERMEDAD = N_COMORBILIDADES / 10,
    FACTOR_CERTEZA = case_when(
        RESULTADO_LAB == 1 | RESULTADO_ANTIGENO == 1 ~ 3,  
        RESULTADO_LAB == 2 | RESULTADO_ANTIGENO == 2 ~ 1,  
        TRUE ~ 2                                           
      ),
    SCORE_RIESGO_COVID = CARGA_ENFERMEDAD * FACTOR_CERTEZA
  )

```

```{r}
summary(DATOS_INICIALES$CARGA_ENFERMEDAD)
summary(DATOS_INICIALES$FACTOR_CERTEZA)
summary(DATOS_INICIALES$SCORE_RIESGO_COVID)
```

```{r}
DATOS_INICIALES <- DATOS_INICIALES |>
  mutate(
    CARGA_ENFERMEDAD = ifelse(CARGA_ENFERMEDAD < 0 | CARGA_ENFERMEDAD > 1, NA, CARGA_ENFERMEDAD),
    SCORE_RIESGO_COVID = ifelse(SCORE_RIESGO_COVID < 0 | SCORE_RIESGO_COVID > 3, NA, SCORE_RIESGO_COVID)
  )
```

```{r}
summary(DATOS_INICIALES$SCORE_RIESGO_COVID)
```

```{r}
summary(DATOS_INICIALES$SCORE_RIESGO_COVID)
```

## INDICE_GRAVEDAD

```{r}
table(DATOS_INICIALES$NEUMONIA, useNA = "always")
table(DATOS_INICIALES$UCI, useNA = "always")
table(DATOS_INICIALES$INTUBADO, useNA = "always")
table(DATOS_INICIALES$ESTADO, useNA = "always")
```

```{r}
DATOS_INICIALES <- DATOS_INICIALES |>
  mutate(
    NEUMONIA01 = case_when(
      NEUMONIA == 1 ~ 1,
      NEUMONIA == 2 ~ 0,
      TRUE ~ NA_real_
    ),
    UCI01 = case_when(
      UCI == 1 ~ 1,
      UCI == 2 ~ 0,
      TRUE ~ NA_real_
    ),
    INTUBADO01 = case_when(
      INTUBADO == 1 ~ 1,
      INTUBADO == 2 ~ 0,
      TRUE ~ NA_real_
    ),
    DEFUNCION01 = case_when(
      ESTADO == "Muerto" ~ 1,
      ESTADO == "Vivo" ~ 0,
      TRUE ~ NA_real_
    ),
    INDICE_GRAVEDAD = (1*NEUMONIA01 + 2*UCI01 + 3*INTUBADO01 + 4*DEFUNCION01) / 10
  )

```

```{r}
summary(DATOS_INICIALES$INDICE_GRAVEDAD)
```

```{r}
DATOS_INICIALES <- DATOS_INICIALES |>
  filter(!is.na(INDICE_GRAVEDAD))

```

```{r}
range(DATOS_INICIALES$INDICE_GRAVEDAD, na.rm = TRUE)
```

```{r}
DATOS_INICIALES |> 
  filter(INDICE_GRAVEDAD < 0 | INDICE_GRAVEDAD > 1) %>%
  nrow()
```

```{r}
summary(DATOS_INICIALES$INDICE_GRAVEDAD)
```

## ENTIDAD_RES

```{r}
table(DATOS_INICIALES$ENTIDAD_RES, useNA = "always")
sum(is.na(DATOS_INICIALES$ENTIDAD_RES))
```

```{r}
DATOS_INICIALES <- DATOS_INICIALES |>
  mutate(
    ENTIDAD_RES = na_if(trimws(as.character(ENTIDAD_RES)), ""),
    ENTIDAD_RES = suppressWarnings(as.integer(ENTIDAD_RES)),
    ENTIDAD_RES = ifelse(ENTIDAD_RES %in% 1:32, ENTIDAD_RES, NA_integer_)
  ) |>
  filter(!is.na(ENTIDAD_RES))
```

```{r}
table(DATOS_INICIALES$ENTIDAD_RES, useNA = "always")
```

## N_COMPLICACIONES_GRAVES

```{r}
summary(DATOS_INICIALES$NEUMONIA)
summary(DATOS_INICIALES$INTUBADO)
summary(DATOS_INICIALES$UCI)
```

```{r}
DATOS_INICIALES <- DATOS_INICIALES |>
  mutate(
    N_COMPLICACIONES_GRAVES =
      (NEUMONIA == 1) + (INTUBADO == 1) + (UCI == 1)
  )
```

```{r}
summary(DATOS_INICIALES$N_COMPLICACIONES_GRAVES)
table(DATOS_INICIALES$N_COMPLICACIONES_GRAVES, useNA = "always")
```

```{r}
DATOS_INICIALES <- DATOS_INICIALES |>
  mutate(
    N_COMPLICACIONES_GRAVES = ifelse(N_COMPLICACIONES_GRAVES %in% 0:3,
                                     N_COMPLICACIONES_GRAVES, NA)
  ) |>
  filter(!is.na(N_COMPLICACIONES_GRAVES))
```

```{r}
table(DATOS_INICIALES$N_COMPLICACIONES_GRAVES, useNA = "always")
```

## TIPO_PACIENTE

```{r}
table(DATOS_INICIALES$TIPO_PACIENTE, useNA = "always")
```

```{r}
DATOS_INICIALES <- DATOS_INICIALES |> 
  filter(!is.na(TIPO_PACIENTE))
```

```{r}
table(DATOS_INICIALES$TIPO_PACIENTE, useNA = "always")
```

## CLASIFICACION_FINAL

```{r}
table(DATOS_INICIALES$CLASIFICACION_FINAL, useNA = "always")
```

```{r}
DATOS_INICIALES <- DATOS_INICIALES |> 
  mutate(CLASIFICACION_FINAL = ifelse(CLASIFICACION_FINAL == 7, NA, CLASIFICACION_FINAL))
```

```{r}
DATOS_INICIALES <- DATOS_INICIALES |> 
  filter(!is.na(CLASIFICACION_FINAL))
```

```{r}
table(DATOS_INICIALES$CLASIFICACION_FINAL, useNA = "always")
```

## Limpiar NA faltantes

```{r}
head(DATOS_INICIALES)
```

```{r}
sum(is.na(DATOS_INICIALES))
```

```{r}
DATOS_FINALES <- DATOS_INICIALES |> 
  filter(complete.cases(DATOS_INICIALES))
```

```{r}
sum(is.na(DATOS_FINALES))
```


## Objetivo 1  

### Mínimo
```{r}
c(
  SCORE_RIESGO_COVID = min(DATOS_FINALES$SCORE_RIESGO_COVID, na.rm = TRUE),
  INDICE_GRAVEDAD    = min(DATOS_FINALES$INDICE_GRAVEDAD,    na.rm = TRUE)
)
```
### Máximo
```{r}
c(
  SCORE_RIESGO_COVID = max(DATOS_FINALES$SCORE_RIESGO_COVID, na.rm = TRUE),
  INDICE_GRAVEDAD    = max(DATOS_FINALES$INDICE_GRAVEDAD,    na.rm = TRUE)
)
```
### Media
```{r}
c(
  SCORE_RIESGO_COVID = mean(DATOS_FINALES$SCORE_RIESGO_COVID, na.rm = TRUE),
  INDICE_GRAVEDAD    = mean(DATOS_FINALES$INDICE_GRAVEDAD,    na.rm = TRUE)
)
```
### Mediana
```{r}
c(
  SCORE_RIESGO_COVID = median(DATOS_FINALES$SCORE_RIESGO_COVID, na.rm = TRUE),
  INDICE_GRAVEDAD    = median(DATOS_FINALES$INDICE_GRAVEDAD,    na.rm = TRUE)
)
```
### Cuartiles
```{r}
rbind(
  SCORE_RIESGO_COVID = quantile(DATOS_FINALES$SCORE_RIESGO_COVID, probs = c(.25,.50,.75), na.rm = TRUE),
  INDICE_GRAVEDAD    = quantile(DATOS_FINALES$INDICE_GRAVEDAD,    probs = c(.25,.50,.75), na.rm = TRUE)
)
```
Desviación estándar
```{r}
c(
  SCORE_RIESGO_COVID = sd(DATOS_FINALES$SCORE_RIESGO_COVID, na.rm = TRUE),
  INDICE_GRAVEDAD    = sd(DATOS_FINALES$INDICE_GRAVEDAD,    na.rm = TRUE)
) 
```
## Objetivo 2 

### Mínimo
```{r}
c(
  N_COMORBILIDADES = min(DATOS_FINALES$N_COMORBILIDADES, na.rm = TRUE),
  TIPO_PACIENTE    = min(as.numeric(DATOS_FINALES$TIPO_PACIENTE), na.rm = TRUE)
)
```

### Máximo
```{r}
c(
  N_COMORBILIDADES = max(DATOS_FINALES$N_COMORBILIDADES, na.rm = TRUE),
  TIPO_PACIENTE    = max(as.numeric(DATOS_FINALES$TIPO_PACIENTE), na.rm = TRUE)
)
```

### Media
```{r}

c(
  N_COMORBILIDADES = mean(DATOS_FINALES$N_COMORBILIDADES, na.rm = TRUE),
  TIPO_PACIENTE    = mean(as.numeric(DATOS_FINALES$TIPO_PACIENTE), na.rm = TRUE)
)
```

### Mediana
```{r}
c(
  N_COMORBILIDADES = median(DATOS_FINALES$N_COMORBILIDADES, na.rm = TRUE),
  TIPO_PACIENTE    = median(as.numeric(DATOS_FINALES$TIPO_PACIENTE), na.rm = TRUE)
)
```

### Cuartiles
```{r}

rbind(
  N_COMORBILIDADES = quantile(DATOS_FINALES$N_COMORBILIDADES, probs = c(.25,.50,.75), na.rm = TRUE),
  TIPO_PACIENTE    = quantile(as.numeric(DATOS_FINALES$TIPO_PACIENTE), probs = c(.25,.50,.75), na.rm = TRUE)
)
```
### Desviación estándar
```{r}

c(
  N_COMORBILIDADES = sd(DATOS_FINALES$N_COMORBILIDADES, na.rm = TRUE),
  TIPO_PACIENTE    = sd(as.numeric(DATOS_FINALES$TIPO_PACIENTE), na.rm = TRUE)
)
```

## Objetivo 3

### Mínimo
```{r}
min(as.numeric(DATOS_FINALES$CLASIFICACION_FINAL), na.rm = TRUE)
```

### Máximo
```{r}
max(as.numeric(DATOS_FINALES$CLASIFICACION_FINAL), na.rm = TRUE)
```

### Media
```{r}
mean(as.numeric(DATOS_FINALES$CLASIFICACION_FINAL), na.rm = TRUE)
```

### Mediana
```{r}
median(as.numeric(DATOS_FINALES$CLASIFICACION_FINAL), na.rm = TRUE)

```

### Cuartiles
```{r}
quantile(
  as.numeric(DATOS_FINALES$CLASIFICACION_FINAL),
  probs = c(0.25, 0.50, 0.75),
  na.rm = TRUE
)
```

### Desviación Estándar
```{r}
sd(as.numeric(DATOS_FINALES$CLASIFICACION_FINAL), na.rm = TRUE)
```



## Objetivo específico 1  
### Distribución del score de riesgo COVID y del índice de gravedad

### Tabla descriptiva

```{r}
tabla_obj1 <- data.frame(
  Score_Min     = min(DATOS_FINALES$SCORE_RIESGO_COVID, na.rm = TRUE),
  Score_Q1      = quantile(DATOS_FINALES$SCORE_RIESGO_COVID, 0.25, na.rm = TRUE),
  Score_Mediana = median(DATOS_FINALES$SCORE_RIESGO_COVID, na.rm = TRUE),
  Score_Media   = mean(DATOS_FINALES$SCORE_RIESGO_COVID, na.rm = TRUE),
  Score_Q3      = quantile(DATOS_FINALES$SCORE_RIESGO_COVID, 0.75, na.rm = TRUE),
  Score_Max     = max(DATOS_FINALES$SCORE_RIESGO_COVID, na.rm = TRUE),
  
  Gravedad_Min     = min(DATOS_FINALES$INDICE_GRAVEDAD, na.rm = TRUE),
  Gravedad_Q1      = quantile(DATOS_FINALES$INDICE_GRAVEDAD, 0.25, na.rm = TRUE),
  Gravedad_Mediana = median(DATOS_FINALES$INDICE_GRAVEDAD, na.rm = TRUE),
  Gravedad_Media   = mean(DATOS_FINALES$INDICE_GRAVEDAD, na.rm = TRUE),
  Gravedad_Q3      = quantile(DATOS_FINALES$INDICE_GRAVEDAD, 0.75, na.rm = TRUE),
  Gravedad_Max     = max(DATOS_FINALES$INDICE_GRAVEDAD, na.rm = TRUE)
)

knitr::kable(tabla_obj1, caption = "Estadísticos descriptivos del score de riesgo COVID y del índice de gravedad")
```
### 1. Histograma SCORE_RIESGO_COVID

```{r}
hist(DATOS_FINALES$SCORE_RIESGO_COVID,
     breaks = 30,
     col = "lightblue",
     freq = FALSE,
     main = "Distribución del Score de Riesgo COVID",
     xlab = "Score de riesgo")
lines(density(DATOS_FINALES$SCORE_RIESGO_COVID, na.rm = TRUE), 
      lwd = 2, col = "red")
```

### 2. Boxplot SCORE_RIESGO_COVID
```{r}
# 2. Boxplot SCORE_RIESGO_COVID
boxplot(DATOS_FINALES$SCORE_RIESGO_COVID,
        col = "lightblue",
        main = "Diagrama de Caja - Score de Riesgo",
        ylab = "Score de riesgo COVID")
```

### 3. Histograma INDICE_GRAVEDAD
```{r}
# 3. Histograma INDICE_GRAVEDAD
hist(DATOS_FINALES$INDICE_GRAVEDAD,
     breaks = 30,
     col = "lightgreen",
     freq = FALSE,
     main = "Distribución del Índice de Gravedad",
     xlab = "Índice de gravedad")
lines(density(DATOS_FINALES$INDICE_GRAVEDAD, na.rm = TRUE), 
      lwd = 2, col = "darkgreen")
```

### 4. Boxplot INDICE_GRAVEDAD
```{r}
# 4. Boxplot INDICE_GRAVEDAD
boxplot(DATOS_FINALES$INDICE_GRAVEDAD,
        col = "lightgreen",
        main = "Diagrama de Caja - Índice de Gravedad",
        ylab = "Índice de gravedad")

```

##Objetivo específico 2
###Relación entre el número de comorbilidades y el tipo de paciente
###Tabla resumen
```{r}

tabla_obj2 <- DATOS_FINALES %>%
  group_by(TIPO_PACIENTE) %>%
  summarise(
    Casos = n(),
    Media_Comorbilidades = mean(N_COMORBILIDADES, na.rm = TRUE),
    Mediana_Comorbilidades = median(N_COMORBILIDADES, na.rm = TRUE),
    Max_Comorbilidades = max(N_COMORBILIDADES, na.rm = TRUE)
  )

knitr::kable(
  tabla_obj2,
  caption = "Número de comorbilidades según tipo de paciente"
)
```



```{r}

ggplot(
  DATOS_FINALES,
  aes(x = factor(TIPO_PACIENTE), y = N_COMORBILIDADES)
) +
  geom_boxplot(fill = "darkgreen", alpha = 0.7) +
  theme_minimal() +
  labs(
    title = "Número de comorbilidades según tipo de paciente",
    x = "Tipo de paciente (1=Ambulatorio, 2=Hospitalizado)",
    y = "Número de comorbilidades"
  ) +
  # Agregar etiquetas para hacerlo más claro
  scale_x_discrete(labels = c("1" = "Ambulatorio", "2" = "Hospitalizado"))
```
## Objetivo específico 3
###DISTRIBUCIÓN DE CASOS SEGÚN SEXO Y CLASIFICACIÓN FINAL

### Tabla de contingencia CORREGIDA
```{r}
# Primero verifiquemos las categorías
cat("Categorías únicas de CLASIFICACION_FINAL:\n")
print(unique(DATOS_FINALES$CLASIFICACION_FINAL))
cat("\nFrecuencia de cada categoría:\n")
print(table(DATOS_FINALES$CLASIFICACION_FINAL))

# Crear la tabla de contingencia
tabla_obj3 <- table(
  DATOS_FINALES$SEXO,
  DATOS_FINALES$CLASIFICACION_FINAL
)

# Ver dimensiones
cat("\nDimensiones de la tabla:", dim(tabla_obj3), "\n")

# Mostrar tabla con nombres correctos
# Como CLASIFICACION_FINAL tiene valores 1, 2, 3, 4, 5, 6
nombres_columnas <- paste("Clasif.", 1:6)

knitr::kable(
  tabla_obj3,
  caption = "Distribución de casos según sexo y clasificación final",
  col.names = nombres_columnas
)

```

###Gráfico de barras agrupadas - número de casos

```{r}
# 1. Gráfico de barras agrupadas - número de casos
barplot(tabla_obj3,
        beside = TRUE,
        col = c("lightblue", "pink"),  # Solo HOMBRE y MUJER
        legend.text = rownames(tabla_obj3),
        args.legend = list(x = "topright", title = "SEXO", cex = 0.8),
        main = "Casos por Sexo y Clasificación Final",
        xlab = "Clasificación Final",
        ylab = "Número de casos",
        names.arg = paste("Clasif.", 1:6),
        cex.names = 0.8)
```
###2. Gráfico de barras apiladas - porcentaje

```{r}
# 2. Gráfico de barras apiladas - porcentaje
prop_tabla3 <- prop.table(tabla_obj3, 2) * 100
barplot(prop_tabla3,
        beside = FALSE,
        col = c("lightblue", "pink"),
        legend.text = rownames(tabla_obj3),
        args.legend = list(x = "topright", title = "SEXO", cex = 0.8),
        main = "Distribución % por Clasificación Final",
        xlab = "Clasificación Final",
        ylab = "Porcentaje (%)",
        names.arg = paste("Clasif.", 1:6),
        cex.names = 0.8)


```




