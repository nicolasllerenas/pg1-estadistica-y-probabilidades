---
title: "Proyecto"
format:
  html:
    toc: true
    toc-depth: 3
    theme: cosmo
    code-fold: true
    code-summary: "Mostrar / ocultar código"
execute:
  echo: true
  warning: false
  message: false
---


## Introducción

La pandemia por COVID-19 ha tenido un impacto significativo en la salud pública a nivel mundial.  
El análisis de datos epidemiológicos permite comprender mejor las características de los casos y los factores asociados a la gravedad de la enfermedad.

Este informe presenta un análisis descriptivo de los **casos sospechosos y confirmados de COVID-19 en México durante el año 2021**, utilizando una muestra de datos oficiales del sistema de vigilancia epidemiológica.



## Objetivo general

Analizar los casos sospechosos y confirmados de COVID-19 en México durante el año 2021, describiendo sus principales características demográficas y clínicas.



## Objetivos específicos

1. Describir la distribución de la edad y el tiempo de retraso entre el inicio de síntomas y el ingreso hospitalario.
2. Analizar el número de comorbilidades y complicaciones graves en los pacientes.
3. Comparar la distribución por sexo entre los casos registrados.


## Metodología

### Población de estudio

La población está conformada por los registros acumulados en el **Sistema de Vigilancia Epidemiológica de Enfermedades Respiratorias Viral (SISVER)** correspondientes al año 2021.

### Tipo de muestreo

Se utilizó un **muestreo aleatorio simple**, garantizando que cada individuo tuviera la misma probabilidad de ser seleccionado.

### Unidad muestral

La unidad muestral es el **individuo (paciente)**.  
Cada fila del conjunto de datos representa a una persona registrada en una unidad de salud.


## Preparación del entorno

```{r}
#| label: setup
#| include: false

library(dplyr)
library(ggplot2)
library(lubridate)
library(knitr)
```


### Carga de datos
```{r}
DATOS_INICIALES <- read.csv("muestra_covid_500M_NA.csv")
DATOS_INICIALES
```

#DATOS INICIALES

```{r}
str(DATOS_INICIALES)
```

## Limpieza de datos

```{r}
DATOS_INICIALES <- DATOS_INICIALES |> 
  mutate(ESTADO = if_else(is.na(FECHA_DEF), "Vivo", "Muerto"))
```

```{r}
DATOS_INICIALES
```

```{r}
sum(is.na(datos))
```

```{r}
sum(is.na(datos$SEXO))
```

```{r}
sum(!complete.cases(datos))
```

```{r}
names(datos)
```

```{r}
sum(!is.na(datos$FECHA_DEF))

table(datos$FECHA_DEF, useNA = "always")
```

```{r}
names(datos)
```

```{r}
library(dplyr)

LOS_FRIOS <- datos |> 
  filter(!is.na(FECHA_DEF), FECHA_DEF != "")

```

```{r}
LOS_FRIOS
```

```{r}
table(LOS_FRIOS$INTUBADO, useNA = "always")
```

```{r}
sum(complete.cases(LOS_FRIOS))
```

```{r}
colSums(is.na(LOS_FRIOS))
```

#LIMPIANDO VARIABLES

```{r}
LOS_FRIOS <- LOS_FRIOS %>%
  filter(!is.na(EDAD) & !is.na(SEXO) & !is.na(FECHA_INGRESO) & !is.na(FECHA_SINTOMAS))

```

#SEXO

```{r}
table(datos$SEXO, useNA = "always")
```

```{r}
datos$SEXO <- as.character(datos$SEXO)
datos$SEXO[datos$SEXO == "1"] <- "Hombre"
datos$SEXO[datos$SEXO == "2"] <- "Mujer"
sexo <- table(datos$SEXO)
barplot(
  sexo,     # Conteo de cada categoría
  ylab = "Frecuencia",              # Etiqueta del eje Y
  xlab = "Sexo",                    # Etiqueta del eje X
  main = "Distribución de Sexo",    # Título del gráfico
  col = c("red", "yellow"),         # Colores de las barras
  border = "black"                  # Bordes de las barras
)
```

```{r}
pie(
  sexo,              # Conteo de cada categoría
  col = c("red", "yellow"),            # Colores más agradables
  main = "Distribución de Sexo",             # Título del gráfico
  labels = paste0(
    names(sexo),     # Etiquetas (M, F, etc.)
    " (", round(100 * prop.table(sexo), 1), "%)"
  )
)

```

#EDAD

```{r}
summary(datos$EDAD)
```

```{r}
datos <- datos |> 
  mutate(EDAD = ifelse(EDAD == 0 | EDAD > 100, NA, EDAD))
```

```{r}
hist(datos$EDAD)
```

```{r}
summary(datos$EDAD)
```

# Dias_retraso

```{r}
library(lubridate)
datos <- datos |> 
  mutate(
    FECHA_INGRESO = as.Date(FECHA_INGRESO, format = "%Y-%m-%d"),
    FECHA_SINTOMAS = as.Date(FECHA_SINTOMAS, format = "%Y-%m-%d"),
    DIAS_RETRASO = as.numeric(FECHA_INGRESO - FECHA_SINTOMAS)
  )
  
```

# n_comorbilidades
```{r}
datos <- datos |>
  mutate(
    n_comorbilidades = rowSums(
      across(
        c(
          DIABETES,
          EPOC,
          ASMA,
          INMUSUPR,
          HIPERTENSION,
          CARDIOVASCULAR,
          OBESIDAD,
          RENAL_CRONICA,
          TABAQUISMO,
          OTRA_COM
        ),
        ~ ifelse(.x == 1, 1, 0)
      ),
      na.rm = TRUE
    )
  )

```


```{r}
colSums(is.na(datos))
```

```{r}
Variables <- datos|> 
  select(SEXO, EDAD, DIAS_RETRASO)
```

```{r}
Variables
```

```{r}
colSums(is.na(Variables))
```

## Variables seleccionadas para el análisis

| \# | Variable | Tipo estadístico | Origen / Cómo se obtiene | Justificación breve |
|---------------|---------------|---------------|---------------|---------------|
| 1 | EDAD | Cuantitativa discreta | Columna original | Edad en años completos, permite media, desviación estándar, correlaciones, etc. |
| 2 | dias_retraso | Cuantitativa discreta | Derivada: FECHA_INGRESO - FECHA_SINTOMAS | Tiempo en días (puede tener decimales si usas unidades="days"), continua clásica |
| 3 | n_comorbilidades | Cuantitativa discreta | Derivada: suma de 10 comorbilidades (solo 1=Sí) | Conteo entero (0 a 10), discreta por naturaleza |
| 4 | n_complicaciones_graves | Cuantitativa discreta | Derivada: suma de NEUMONIA + INTUBADO + UCI (solo 1=Sí) | Conteo entero (0 a 3), discreta, indica severidad |
| 5 | SEXO | Cualitativa nominal | Columna original | Categorías sin orden: Mujer / Hombre / No especificado |
| 6 | ENTIDAD_RES | Cualitativa nominal | Columna original | 32 entidades federativas + posible 99, sin orden jerárquico |
| 7 | TIPO_PACIENTE | Cualitativa ordinal | Columna original | 1 = Ambulatorio \< 2 = Hospitalizado (orden lógico de gravedad) |
| 8 | CLASIFICACION_FINAL | Cualitativa ordinal | Columna original | Niveles con jerarquía de certeza/severidad (Confirmado \> Sospechoso \> otros) |

### Objetivos específicos

1.  **Describir la distribución de la edad y el tiempo de retraso entre el inicio de síntomas y el ingreso hospitalario en los casos sospechosos y confirmados de COVID-19 en México durante el año 2021.**\
    Variables principales: EDAD, dias_retraso, CLASIFICACION_FINAL\
    Métodos sugeridos: estadísticos descriptivos (media, mediana, percentiles), histogramas, boxplots, tablas resumen.

2.  **Analizar la relación entre el número de comorbilidades y el número de complicaciones graves con el tipo de atención requerida en los casos sospechosos y confirmados de COVID-19 en México durante el año 2021.**\
    Variables principales: n_comorbilidades, n_complicaciones_graves, TIPO_PACIENTE\
    Métodos sugeridos: tablas cruzadas, porcentajes, gráficos de barras apiladas, prueba chi-cuadrado o correlación de Spearman.

3.  **Comparar la distribución por sexo y entidad de residencia entre los casos sospechosos y confirmados de COVID-19 en México durante el año 2021.**\
    Variables principales: SEXO, ENTIDAD_RES, CLASIFICACION_FINAL\
    Métodos sugeridos: tablas de contingencia, gráficos de barras apiladas o mosaico, prueba de independencia chi-cuadrado.#Objetivos especificos

```{r}
#| label: analisis-edad

# Tabla descriptiva de EDAD
tabla_edad <- datos_limpios %>%
  group_by(CLASIFICACION_FINAL) %>%
  summarise(
    Casos = n(),
    Media = round(mean(EDAD, na.rm = TRUE), 2),
    Mediana = median(EDAD, na.rm = TRUE),
    Desv.Std = round(sd(EDAD, na.rm = TRUE), 2),
    Min = min(EDAD, na.rm = TRUE),
    Max = max(EDAD, na.rm = TRUE)
  )

# Imprimimos tabla
knitr::kable(tabla_edad, caption = "Estadísticos descriptivos de EDAD por Clasificación")
```

```{r}
#| label: graficos-edad
#| fig.width: 10
#| fig.height: 8

# Histograma General con curva de densidad
p1 <- ggplot(datos_limpios, aes(x = EDAD)) +
  geom_histogram(aes(y = ..density..), binwidth = 5, fill = "#69b3a2", color = "white", alpha=0.8) +
  geom_density(alpha = 0.2, fill = "#FF6666") +
  theme_minimal() +
  labs(title = "A) Distribución General de la Edad",
       subtitle = "Histograma con curva de densidad",
       x = "Edad (años)", y = "Densidad")

# Boxplot por Clasificación para comparar grupos
p2 <- ggplot(datos_limpios, aes(x = CLASIFICACION_FINAL, y = EDAD, fill = CLASIFICACION_FINAL)) +
  geom_boxplot(alpha = 0.6, outlier.size = 0.5, outlier.alpha = 0.3) +
  theme_minimal() +
  theme(legend.position = "none", 
        axis.text.x = element_text(angle = 45, hjust = 1, size = 8)) +
  labs(title = "B) Comparación de Edad por Clasificación",
       subtitle = "Diagrama de Caja y Bigotes",
       x = "Clasificación", y = "Edad (años)")


p1
p2
```
